# Fly.io configuration for CrawlReady Render Worker

app = "crawlready-render-worker"
primary_region = "iad" # US East

[build]
dockerfile = "Dockerfile"

[env]
NODE_ENV = "production"
WORKER_CONCURRENCY = "3"
HEALTH_PORT = "8080"

[[services]]
internal_port = 8080
protocol = "tcp"

[[services.ports]]
port = 80
handlers = [ "http" ]

[[services.ports]]
port = 443
handlers = [
  "tls",
  "http"
]

[services.concurrency]
type = "connections"
hard_limit = 25
soft_limit = 20

[[services.tcp_checks]]
interval = "15s"
timeout = "2s"
grace_period = "5s"

# Resources
[vm]
size = "shared-cpu-2x" # 2 vCPUs, 512MB RAM
memory = "512mb"

# Auto-scaling
[auto_scaling]
min_machines_running = 1
max_machines_running = 5

# Secrets (set via fly secrets set)
# - DATABASE_URL
# - UPSTASH_REDIS_HOST
# - UPSTASH_REDIS_PORT
# - UPSTASH_REDIS_PASSWORD
# - UPSTASH_REDIS_TLS
# - SUPABASE_URL
# - SUPABASE_KEY
